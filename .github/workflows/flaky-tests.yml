name: Flaky Tests
on: [push]

jobs:
  build:
    name: Running Flaky Tests
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout main branch
        uses: actions/checkout@v2
        with:
          repository: TestingResearchIllinois/idoft
          ref: b31c29526ac35b32b03d8cf9017e79a51fbe43e8      
        
      - name: Set up JDK
        uses: actions/setup-java@v1
        with:
          java-version: 1.8
          
      - name: Get 10 random tests
        run: grep ,ID,, pr-data.csv | grep -v \\[ | shuf --random-source=<(while :; do echo kgomez22@gmu.edu; done) | head
      
      
      
 #     - name: Clone first test's repo
 #       run: git clone https://github.com/vojtechhabarta/typescript-generator
 #            
 #     - run: cd typescript-generator
 #    
 #     - name: Checkout the latest commit
 #       uses: actions/checkout@v2
 #       with:
 #         repository: vojtechhabarta/typescript-generator
 #         ref: c19d407fea52612e7b7cd20620059736aec9a6a9
 #         
 #     - name: Compile the module
 #       run: mvn test-compile -pl typescript-generator-core -am
 #       
 #     - name: A Passing Test
 #       run: mvn -pl typescript-generator-core test -Dtest=cz.habarta.typescript.generator.TaggedUnionsTest#testTaggedUnionsWithInterfaces
 #       
 #     - name: A failing test with NonDex tool
 #       run: mvn -pl typescript-generator-core edu.illinois:nondex-maven-plugin:1.1.2:nondex -Dtest=cz.habarta.typescript.generator.TaggedUnionsTest#testTaggedUnionsWithInterfaces -DnondexRuns=10
        
        
        
      - name: Clone second test's repo
        run: git clone https://github.com/alibaba/fastjson
             
      - run: cd fastjson
     
      - name: Checkout the latest commit
        uses: actions/checkout@v2
        with:
          repository: alibaba/fastjson
          ref: a7f1f5c4ac52503cc95bf1d27498098b3093a0df
          
      - name: Compile the module
        run: mvn test-compile -pl . -am
        
      - name: A Passing Test
        run: mvn -pl . test -Dtest=com.alibaba.json.bvt.issue_1400.Issue1493#test_for_issue
        
      - name: A failing test with NonDex tool
        run: mvn -pl . edu.illinois:nondex-maven-plugin:1.1.2:nondex -Dtest=com.alibaba.json.bvt.issue_1400.Issue1493#test_for_issue -DnondexRuns=10  

